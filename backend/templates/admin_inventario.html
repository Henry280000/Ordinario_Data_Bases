{% extends 'base.html' %}

{% block title %}Gestión de Inventario{% endblock %}

{% block content %}
<section class="section">
    <div style="max-width: 1400px; margin: 0 auto;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
            <h2 style="font-weight: 900;">GESTIÓN DE INVENTARIO</h2>
            <div style="display: flex; gap: 10px;">
                <a href="{{ url_for('admin_dashboard') }}" class="btn btn-secondary">VOLVER AL DASHBOARD</a>
                <a href="{{ url_for('admin_agregar_inventario') }}" class="btn btn-primary">AGREGAR NUEVO PRODUCTO</a>
            </div>
        </div>
        
        <div style="background: white; border-radius: 8px; overflow: hidden;">
            <table style="width: 100%; border-collapse: collapse;">
                <thead style="background: #f5f5f5;">
                    <tr>
                        <th style="padding: 15px; text-align: left; font-weight: 700;">SKU</th>
                        <th style="padding: 15px; text-align: left; font-weight: 700;">PRODUCTO</th>
                        <th style="padding: 15px; text-align: center; font-weight: 700;">TALLA</th>
                        <th style="padding: 15px; text-align: center; font-weight: 700;">STOCK</th>
                        <th style="padding: 15px; text-align: right; font-weight: 700;">PRECIO</th>
                        <th style="padding: 15px; text-align: center; font-weight: 700;">ÚLTIMA ACTUALIZACIÓN</th>
                        <th style="padding: 15px; text-align: center; font-weight: 700;">ACCIONES</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in inventario %}
                    <tr style="border-bottom: 1px solid #e5e5e5;">
                        <td style="padding: 15px; font-family: monospace; font-size: 12px;">{{ item.sku }}</td>
                        <td style="padding: 15px; font-weight: 600;">{{ item.nombre_producto }}</td>
                        <td style="padding: 15px; text-align: center; font-weight: 700;">{{ item.talla }}</td>
                        <td style="padding: 15px; text-align: center;">
                            <span style="padding: 5px 15px; border-radius: 20px; font-weight: 700; 
                                        {% if item.cantidad_disponible < 20 %}background: #fee; color: #c00;
                                        {% elif item.cantidad_disponible < 50 %}background: #ffeaa7; color: #d63031;
                                        {% else %}background: #d4edda; color: #155724;{% endif %}">
                                {{ item.cantidad_disponible }}
                            </span>
                        </td>
                        <td style="padding: 15px; text-align: right; font-weight: 600;">${{ "%.2f"|format(item.precio_unitario) }}</td>
                        <td style="padding: 15px; text-align: center; color: #767677; font-size: 12px;">
                            {{ item.fecha_actualizacion.strftime('%d/%m/%Y %H:%M') if item.fecha_actualizacion else 'N/A' }}
                        </td>
                        <td style="padding: 15px; text-align: center;">
                            <button onclick="mostrarFormulario({{ item.id_inventario }}, '{{ item.nombre_producto }}', '{{ item.talla }}', {{ item.cantidad_disponible }})" 
                                    class="btn btn-primary" style="padding: 8px 15px; font-size: 12px;">
                                EDITAR STOCK
                            </button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</section>

<!-- Modal para editar stock -->
<div id="modalEditarStock" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                                    background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
    <div style="background: white; padding: 40px; border-radius: 8px; max-width: 500px; width: 90%;">
        <h3 style="font-weight: 900; margin-bottom: 20px;">ACTUALIZAR STOCK</h3>
        <form method="POST" id="formEditarStock">
            <div class="form-group">
                <label class="form-label">PRODUCTO</label>
                <input type="text" id="productoNombre" class="form-input" readonly>
            </div>
            <div class="form-group">
                <label class="form-label">TALLA</label>
                <input type="text" id="productoTalla" class="form-input" readonly>
            </div>
            <div class="form-group">
                <label class="form-label">CANTIDAD ACTUAL</label>
                <input type="text" id="cantidadActual" class="form-input" readonly>
            </div>
            <div class="form-group">
                <label class="form-label">NUEVA CANTIDAD</label>
                <input type="number" name="cantidad" id="nuevaCantidad" class="form-input" min="0" required>
            </div>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button type="submit" class="btn btn-primary" style="flex: 1;">ACTUALIZAR</button>
                <button type="button" onclick="cerrarModal()" class="btn btn-secondary" style="flex: 1;">CANCELAR</button>
            </div>
        </form>
    </div>
</div>

<script>
function mostrarFormulario(id, nombre, talla, cantidadActual) {
    document.getElementById('formEditarStock').action = '/admin/inventario/' + id + '/actualizar';
    document.getElementById('productoNombre').value = nombre;
    document.getElementById('productoTalla').value = talla;
    document.getElementById('cantidadActual').value = cantidadActual;
    document.getElementById('nuevaCantidad').value = cantidadActual;
    document.getElementById('modalEditarStock').style.display = 'flex';
}

function cerrarModal() {
    document.getElementById('modalEditarStock').style.display = 'none';
}

// Cerrar modal al hacer clic fuera
document.getElementById('modalEditarStock').addEventListener('click', function(e) {
    if (e.target === this) {
        cerrarModal();
    }
});
</script>
{% endblock %}
