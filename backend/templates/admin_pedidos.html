{% extends 'base.html' %}

{% block title %}Admin - Pedidos{% endblock %}

{% block content %}
<section class="section">
    <div style="max-width: 1400px; margin: 0 auto;">
        <a href="{{ url_for('admin_dashboard') }}" class="btn btn-secondary" style="margin-bottom: 20px;">VOLVER AL DASHBOARD</a>
        
        <h2 style="text-align: center; margin-bottom: 40px; font-weight: 900;">TODOS LOS PEDIDOS</h2>
        
        <!-- Filtros -->
        <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; display: flex; gap: 15px; align-items: center;">
            <span style="font-weight: 700;">FILTRAR POR ESTADO:</span>
            <a href="{{ url_for('admin_pedidos') }}" class="btn btn-secondary" style="padding: 8px 15px;">TODOS</a>
            <a href="{{ url_for('admin_pedidos') }}?estado=PENDIENTE" class="btn btn-secondary" style="padding: 8px 15px;">PENDIENTE</a>
            <a href="{{ url_for('admin_pedidos') }}?estado=PROCESANDO" class="btn btn-secondary" style="padding: 8px 15px;">PROCESANDO</a>
            <a href="{{ url_for('admin_pedidos') }}?estado=COMPLETADO" class="btn btn-secondary" style="padding: 8px 15px;">COMPLETADO</a>
            <a href="{{ url_for('admin_pedidos') }}?estado=CANCELADO" class="btn btn-secondary" style="padding: 8px 15px;">CANCELADO</a>
        </div>
        
        {% if pedidos %}
        <table style="width: 100%; background: white; border-radius: 8px; overflow: hidden;">
            <thead style="background: #000; color: white;">
                <tr>
                    <th style="padding: 15px; text-align: left;">ID</th>
                    <th style="padding: 15px;">CLIENTE</th>
                    <th style="padding: 15px;">DIRECCIÃ“N</th>
                    <th style="padding: 15px;">FECHA</th>
                    <th style="padding: 15px;">TOTAL</th>
                    <th style="padding: 15px;">ESTADO</th>
                    <th style="padding: 15px;">ACCIONES</th>
                </tr>
            </thead>
            <tbody>
                {% for pedido in pedidos %}
                <tr style="border-bottom: 1px solid #eee;">
                    <td style="padding: 15px;">
                        <strong>#{{ pedido.id_pedido }}</strong>
                    </td>
                    <td style="padding: 15px;">
                        {{ pedido.nombre_usuario }}<br>
                        <small style="color: #767677;">{{ pedido.email }}</small>
                    </td>
                    <td style="padding: 15px; font-size: 13px;">
                        {{ pedido.direccion_envio[:50] }}{% if pedido.direccion_envio|length > 50 %}...{% endif %}
                    </td>
                    <td style="padding: 15px; text-align: center;">
                        {{ pedido.fecha_pedido.strftime('%d/%m/%Y') }}<br>
                        <small style="color: #767677;">{{ pedido.fecha_pedido.strftime('%H:%M') }}</small>
                    </td>
                    <td style="padding: 15px; text-align: center; font-weight: 700;">
                        ${{ "%.2f"|format(pedido.total) }}
                    </td>
                    <td style="padding: 15px; text-align: center;">
                        <form method="POST" action="{{ url_for('admin_cambiar_estado', pedido_id=pedido.id_pedido) }}" style="display: inline-block;">
                            <select name="nuevo_estado" onchange="this.form.submit()" class="form-input" style="padding: 5px; font-size: 12px; font-weight: 700;
                                {% if pedido.estado == 'COMPLETADO' %}background: #28a745; color: white;
                                {% elif pedido.estado == 'PENDIENTE' %}background: #ffc107; color: #000;
                                {% elif pedido.estado == 'CANCELADO' %}background: #dc3545; color: white;
                                {% else %}background: #17a2b8; color: white;{% endif %}">
                                <option value="PENDIENTE" {% if pedido.estado == 'PENDIENTE' %}selected{% endif %}>PENDIENTE</option>
                                <option value="PROCESANDO" {% if pedido.estado == 'PROCESANDO' %}selected{% endif %}>PROCESANDO</option>
                                <option value="COMPLETADO" {% if pedido.estado == 'COMPLETADO' %}selected{% endif %}>COMPLETADO</option>
                                <option value="CANCELADO" {% if pedido.estado == 'CANCELADO' %}selected{% endif %}>CANCELADO</option>
                            </select>
                        </form>
                    </td>
                    <td style="padding: 15px; text-align: center;">
                        <a href="{{ url_for('pedido_detalle', pedido_id=pedido.id_pedido) }}" class="btn btn-secondary" style="padding: 5px 15px; font-size: 13px;">
                            VER DETALLE
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div style="text-align: center; padding: 60px; background: white; border-radius: 8px;">
            <h3 style="font-weight: 700;">No hay pedidos registrados</h3>
        </div>
        {% endif %}
    </div>
</section>
{% endblock %}
