{% extends 'base.html' %}

{% block title %}Mis Pedidos{% endblock %}

{% block content %}
<section class="section">
    <div style="max-width: 1200px; margin: 0 auto;">
        <h2 style="text-align: center; margin-bottom: 40px; font-weight: 900;">MIS PEDIDOS</h2>
        
        {% if pedidos %}
        
        <!-- Resumen de pedidos -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
            <div style="background: white; padding: 20px; border-radius: 8px; text-align: center;">
                <div style="font-size: 32px; font-weight: 900; color: #ff6b00;">{{ pedidos|length }}</div>
                <div style="color: #767677; font-size: 14px;">TOTAL PEDIDOS</div>
            </div>
            <div style="background: white; padding: 20px; border-radius: 8px; text-align: center;">
                <div style="font-size: 32px; font-weight: 900; color: #ffc107;">{{ pedidos|selectattr('estado', 'equalto', 'PENDIENTE')|list|length + pedidos|selectattr('estado', 'equalto', 'PROCESANDO')|list|length }}</div>
                <div style="color: #767677; font-size: 14px;">EN PROCESO</div>
            </div>
            <div style="background: white; padding: 20px; border-radius: 8px; text-align: center;">
                <div style="font-size: 32px; font-weight: 900; color: #28a745;">{{ pedidos|selectattr('estado', 'equalto', 'COMPLETADO')|list|length }}</div>
                <div style="color: #767677; font-size: 14px;">COMPLETADOS</div>
            </div>
        </div>
        
        <table style="width: 100%; background: white; border-radius: 8px; overflow: hidden;">
            <thead style="background: #000; color: white;">
                <tr>
                    <th style="padding: 15px; text-align: left;">ID PEDIDO</th>
                    <th style="padding: 15px;">FECHA</th>
                    <th style="padding: 15px;">DIRECCIÓN</th>
                    <th style="padding: 15px;">ITEMS</th>
                    <th style="padding: 15px;">TOTAL</th>
                    <th style="padding: 15px;">ESTADO</th>
                    <th style="padding: 15px;">ACCIONES</th>
                </tr>
            </thead>
            <tbody>
                {% for pedido in pedidos %}
                <tr style="border-bottom: 1px solid #eee;">
                    <td style="padding: 15px;">
                        <strong style="font-size: 18px; color: #ff6b00;">#{{ pedido.id_pedido }}</strong>
                    </td>
                    <td style="padding: 15px; text-align: center;">
                        {{ pedido.fecha_pedido.strftime('%d/%m/%Y') }}<br>
                        <small style="color: #767677;">{{ pedido.fecha_pedido.strftime('%H:%M') }}</small>
                    </td>
                    <td style="padding: 15px; font-size: 13px;">
                        {{ pedido.direccion_envio[:40] }}{% if pedido.direccion_envio|length > 40 %}...{% endif %}
                    </td>
                    <td style="padding: 15px; text-align: center; font-weight: 700;">
                        {{ pedido.total_items }}
                    </td>
                    <td style="padding: 15px; text-align: center;">
                        <div style="font-size: 20px; font-weight: 900; color: #000;">${{ "%.2f"|format(pedido.total) }}</div>
                    </td>
                    <td style="padding: 15px; text-align: center;">
                        <span style="padding: 8px 15px; border-radius: 20px; font-size: 12px; font-weight: 700;
                            {% if pedido.estado == 'COMPLETADO' %}background: #28a745; color: white;
                            {% elif pedido.estado == 'PENDIENTE' %}background: #ffc107; color: #000;
                            {% elif pedido.estado == 'CANCELADO' %}background: #dc3545; color: white;
                            {% else %}background: #17a2b8; color: white;{% endif %}">
                            {{ pedido.estado }}
                        </span>
                    </td>
                    <td style="padding: 15px; text-align: center;">
                        <a href="{{ url_for('pedido_detalle', pedido_id=pedido.id_pedido) }}" class="btn btn-secondary" style="padding: 8px 15px;">
                            VER DETALLE
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div style="text-align: center; padding: 60px; background: white; border-radius: 8px;">
            <h3 style="font-weight: 700; margin-bottom: 20px;">No tienes pedidos aún</h3>
            <a href="{{ url_for('catalogo') }}" class="btn btn-primary">IR AL CATÁLOGO</a>
        </div>
        {% endif %}
    </div>
</section>
{% endblock %}
